#include <stdio.h>
#include <stdint.h>
#include <cuda_runtime.h>
#include "../ker-division.cu.h"
//#include "../ker-division-64.cu.h"
#include "../helpers/helper.h"

int main()
{
   // using Base = U32bits;
   // using Base = U64bits;
    using Base = U16bits;
   // using Base = U8bits;
    using uint_t = Base::uint_t;
    const uint32_t M = 32;
    const uint32_t Q = 4;

    // uint_t u[16] = {35165, 45317, 41751, 43096, 23273, 33886, 43220, 48555, 36018, 53453, 57542, 0, 0, 0, 0, 0};
    // uint_t v[16] = {30363, 40628, 9300, 34321, 50190, 7554, 63604, 34369, 0, 0, 0, 0, 0, 0, 0, 0};


    // uint_t u[8] = {4, 2, 2, 2, 2, 2, 0, 0};
    // uint_t v[8] = {4, 1, 1, 1, 1, 0, 0, 0};

    // uint_t u[16] = {4, 2, 2, 2, 2, 2, 2, 2,2,2,2,0,0,0,0,0};
    // uint_t v[16] = {65535, 1, 1, 1, 1, 1, 1, 1,1,0,0,0,0,0,0,0};


    // uint_t u[32] = {4, 2, 2, 2, 2, 2, 2, 2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,0,0,0,0};
    // uint_t v[32] = {4, 1, 1, 1, 1, 1, 1, 1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};

    // uint_t u[16] = {39017, 18547, 56401, 23807, 37962, 22764, 7977, 31949, 0, 0, 0, 0, 0, 0, 0, 0};
    // uint_t v[16] = {22714, 55211, 16882, 7931, 43491, 57670, 124, 0, 0, 0, 0, 0, 0, 0, 0, 0};

    // uint_t u[16] = {7, 3, 5, 10, 7, 9, 7, 9, 7, 2, 2, 10, 0, 0, 0, 0};
    // uint_t v[16] = {4, 4, 5, 1, 7, 2, 2, 10, 0, 0, 0, 0, 0, 0, 0, 0};

    // uint_t u[32] = {4, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,2,2,2,2,2,2,2,2,2,2,2,0,0,0,0,0};
    // uint_t v[32] = {65535, 1, 1, 1, 1, 1, 1, 65535, 1, 1, 1, 1, 1, 1, 1, 1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0};

    // uint_t u[32] = {4295, 1, 1, 19047, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0};
    // uint_t v[32] = {1, 24982, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0};

    // uint_t u[32] = {107, 152, 26, 164, 95, 172, 25, 13, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0};
    // uint_t v[32] = {1, 224, 1, 195, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0};

    uint_t u[32] = {1, 1, 1, 1, 1, 1, 1, 2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
    uint_t v[32] = {1, 1, 0, 0, 0, 0, 0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};

    // uint_t u[16] = {58205, 29807, 37142, 18428, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0};
    // uint_t v[16] = {46992, 20179, 51535, 21667, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0};

    // uint_t u[32] = {8, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0};
    // uint_t v[32] = {4, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0};

    // uint_t u[32] = {1, 3, 1, 1, 4, 2, 1, 3, 2, 3, 3, 2, 2, 2, 2, 4, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0};
    // uint_t v[32] = {3, 1, 3, 4, 4, 1, 2, 2, 2, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0};

    // uint_t u[32] = {4, 3, 1, 4, 2, 2, 1, 3, 1, 1, 2, 3, 2, 3, 3, 2, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0};
    // uint_t v[32] = {3, 3, 4, 2, 4, 4, 3, 4, 2, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0};

    // uint_t u[16] = {4, 2, 2, 2, 2, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0};
    // uint_t v[16] = {65535, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0};
    
    // uint_t u[16] = {1681692777, 1714636915, 1957747793, 424238335, 719885386, 1649760492, 596516649, 1189641421, 0, 0, 0, 0, 0, 0, 0, 0};
    // uint_t v[16] = {1025202362, 1350490027, 783368690, 1102520059, 2044897763, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0};
    

    // uint_t u[64] = {39017, 18547, 56401, 23807, 37962, 22764, 7977, 31949, 22714, 55211, 16882, 7931, 43491, 57670, 124, 25282, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0};
    // uint_t v[64] = {2132, 10232, 8987, 59880, 52711, 17293, 3958, 9562, 63790, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0};


    uint_t quo[M] = {0};
    uint_t rem[M] = {0};

    uint_t *d_u, *d_v, *d_quo, *d_rem;
    cudaMalloc((void **)&d_u, M * sizeof(uint_t));
    cudaMalloc((void **)&d_v, M * sizeof(uint_t));
    cudaMalloc((void **)&d_quo, M * sizeof(uint_t));
    cudaMalloc((void **)&d_rem, M * sizeof(uint_t));

    cudaMemcpy(d_u, u, M * sizeof(uint_t), cudaMemcpyHostToDevice);
    cudaMemcpy(d_v, v, M * sizeof(uint_t), cudaMemcpyHostToDevice);

    divShinvKer<Base, M, Q><<<1, M/Q, 2 * M * sizeof(uint_t)>>>(d_u, d_v, d_quo, d_rem);
    cudaDeviceSynchronize();

    cudaMemcpy(quo, d_quo, M * sizeof(uint_t), cudaMemcpyDeviceToHost);
    cudaMemcpy(rem, d_rem, M * sizeof(uint_t), cudaMemcpyDeviceToHost);

    uint_t quo_gmp[M] = {0};
    uint_t rem_gmp[M] = {0};
    div_gmp(u, v, quo_gmp, rem_gmp, M);

    prnt<uint_t>("u", u, M);
    prnt<uint_t>("v", v, M);

    prnt<uint_t>("quo", quo, M);
    prnt<uint_t>("rem", rem, M);
    prnt<uint_t>("quo_gmp", quo_gmp, M);
    prnt<uint_t>("rem_gmp", rem_gmp, M);

    for (int i = 0; i < M; i++)
    {
        if (quo[i] != quo_gmp[i] || rem[i] != rem_gmp[i])
        {
            printf("INVALID \n");
            break;
        }
    }
    return 0;
}